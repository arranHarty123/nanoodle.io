<header class="masthead">
  <div class="section-heading text-center">
    <img src="../../assets/nanoodle_logo.svg" width="50px" class="img-fluid" alt="">
    <br>
    <h3>Account Overview</h3>
    <br>
  </div>
</header>
<section class="features" id="features">
  <ng-container *ngIf="error; then errorPresent; else results">
  </ng-container>
  <ng-template #errorPresent>
    <div class="container">
      <h3>Address</h3>
      <p>Error: {{ error }}</p>
    </div>
  </ng-template>
  <ng-template #results>
    <div class="container">
      <ng-container *ngIf="blockCountResults; then blockCountLoaded; else blockCountLoading">
      </ng-container>
      <ng-template #blockCountLoaded>
        <p>The NANOODLE node is {{
          formatDecimals(+(+blockCountResults['count']/(+blockCountResults['count']++blockCountResults['unchecked']))*100)
          }}% in sync with the Nano network</p>
      </ng-template>
      <ng-template #blockCountLoading>
        <i class="fa fa-refresh fa-spin fa-lg fa-fw"></i>
      </ng-template>
      <h3>Identifier</h3>
      <ng-container *ngIf="accountResults; then accountLoaded; else accountLoading">
      </ng-container>
      <ng-template #accountLoaded>
        <p>
          <qrcode [qrdata]="accountResults['account']" [size]="128" [level]="'M'"></qrcode>
        </p>
        <p><a class="account" [routerLink]="['/account',accountResults['account']]">{{ accountResults['account'] }}</a></p>
      </ng-template>
      <ng-template #accountLoading>
        <div>
          <i class="fa fa-refresh fa-spin fa-lg fa-fw"></i>
        </div>
      </ng-template>
    </div>
    <div class="container">
      <h3>Balance</h3>
      <ng-container *ngIf="balanceResults; then balanceLoaded; else balanceLoading">
      </ng-container>
      <ng-template #balanceLoaded>
        <p>{{ formatAmount(balanceResults['balance']) }} (excluding {{formatAmount(balanceResults['pending'])}}
          pending)</p>
      </ng-template>
      <ng-template #balanceLoading>
        <div>
          <i class="fa fa-refresh fa-spin fa-lg fa-fw"></i>
        </div>
      </ng-template>
    </div>
    <div class="container">
      <h3>Unprocessed Blocks</h3>
      <ng-container *ngIf="keys; then blocksloaded; else blocksloading">
      </ng-container>
      <ng-template #blocksloaded>
        <ng-container *ngIf="keys.length > 0; then blocksShow; else blocksEmpty">
        </ng-container>
        <ng-template #blocksShow>
          <p>Showing up to the last 20 incoming blocks for which the account has not yet published a block to complete
            the transaction</p>
          <div class="row">
            <div class="col-lg-12 my-auto">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th scope="col">NANOODLE Time (UTC)</th>
                    <th scope="col"><img src="../../assets/nano_logo_black.svg" width="30px"></th>
                    <th scope="col">Associated Account</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let key of keys; let u = index">
                    <td title="Click to see block details" data-toggle="popover" scope="row">
                      <app-blockTime [hyperlink]=true [hash]=key></app-blockTime>
                    </td>
                    <td [attr.id]="'unprocessedAmount' + u">{{ formatType('receive', 'unprocessedAmount'+u)}}{{
                      formatAmount(blockResults.blocks[key].amount) }}</td>
                    <td class="account" title="Click to see account details" data-toggle="popover"><a [routerLink]="['/account',blockResults.blocks[key].block_account]">{{
                        blockResults.blocks[key].block_account }}</a></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </ng-template>
      </ng-template>
      <ng-template #blocksEmpty>
        <p>No incoming blocks</p>
      </ng-template>
      <ng-template #blocksloading>
        <div>
          <i class="fa fa-refresh fa-spin fa-lg fa-fw"></i>
        </div>
      </ng-template>
    </div>
    <div class="container">
      <h3>Transactions</h3>
      <ng-container *ngIf="accountResults; then transactionLoaded; else transactionLoading">
      </ng-container>
      <ng-template #transactionLoaded>
        <ng-container *ngIf="accountResults['history'].length > 0; then transactionsShow; else transactionsEmpty">
        </ng-container>
        <ng-template #transactionsShow>
          <p>Showing up to the last 20 transactions</p>
          <div class="row">
            <div class="col-lg-12 my-auto">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th scope="col">NANOODLE Time (UTC)</th>
                    <th scope="col"><img src="../../assets/nano_logo_black.svg" width="30px"></th>
                    <th scope="col">Associated Account</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let transaction of accountResults['history']; let i = index">
                    <td title="Click to see block details" data-toggle="popover" scope="row">
                      <app-blockTime [hyperlink]=true [hash]=transaction.hash></app-blockTime>
                    </td>
                    <td [attr.id]="'transactionAmount' + i">{{ formatType(transaction.type, 'transactionAmount'+i)
                      }}{{formatAmount(transaction.amount) }}</td>
                    <td title="Click to see account details" data-toggle="popover"><a class=account [routerLink]="['/account',transaction.account]">{{
                        transaction.account }}</a></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </ng-template>
        <ng-template #transactionsEmpty>
          <p>No transactions in account history</p>
        </ng-template>
      </ng-template>
      <ng-template #transactionLoading>
        <div>
          <i class="fa fa-refresh fa-spin fa-lg fa-fw"></i>
        </div>
      </ng-template>
    </div>
    <div class="container">
      <h3>Voting</h3>
      <ng-container *ngIf="representativeResults; then representativeLoaded; else representativeLoading">
      </ng-container>
      <ng-template #representativeLoaded>
        <ng-container *ngIf="representativeResults['representative']; then representativeShow; else representativeEmpty">
        </ng-container>
        <ng-template #representativeShow>
          <p>This account's representative is:
            <a class=account [routerLink]="['/account',representativeResults['representative']]">{{
              representativeResults['representative'] }}</a>
        </ng-template>
        <ng-template #representativeEmpty>
          <p>This account has no representative set</p>
        </ng-template>
      </ng-template>
      <ng-template #representativeLoading>
        <div>
          <i class="fa fa-refresh fa-spin fa-lg fa-fw"></i>
        </div>
      </ng-template>
      <ng-container *ngIf="weightResults; then weightLoaded; else weightloading">
      </ng-container>
      <ng-template #weightLoaded>
        <p>This account has {{formatAmount(weightResults['weight'])}} voting weight</p>
      </ng-template>
      <ng-template #weightloading>
        <div>
          <i class="fa fa-refresh fa-spin fa-lg fa-fw"></i>
        </div>
      </ng-template>
      <h3>NANOODLE Books</h3>
      <p>Download this account's transactions in a variety of formats</p>
      <app-accountDownload [identifier]=identifier></app-accountDownload>
    </div>
  </ng-template>
</section>